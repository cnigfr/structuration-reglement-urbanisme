 <!DOCTYPE html>
 <html>
 <head>
  <title>Extraction des zones PLU de Jaleyrac</title>
  <meta name="description" content="page permettant de filtrer le PLU en fonction du zonage" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="keywords" content="CNIG,PLU,règlement,zonage" />
  <meta name="author" content="Stéphane Garcia, CNIG" />
  <link href="style.css" rel="stylesheet" type="text/css">
</head>
<body>
  <header>
    <!-- liste déroulante -->
    <FORM NAME="Choix">Consulter un zonage :
      <SELECT NAME="Liste" onChange="Init()">
        <OPTION VALUE="all" selected>Toutes les zones</OPTION>
        <OPTION VALUE="UG">Zone Urbaine Générale</OPTION>
        <OPTION VALUE="UE">Zone Urbaine d'Equipements</OPTION>
        <OPTION VALUE="UX">Zone urbaine d'activités</OPTION>
        <OPTION VALUE="1AU">Zone à urbaniser</OPTION>
        <OPTION VALUE="2AU">Zone à urbaniser fermée</OPTION>
        <OPTION VALUE="A">Zone Agricole</OPTION>
        <OPTION VALUE="N">Zone Naturelle</OPTION>
      </SELECT>
    </FORM>
    <hr/>
  </header>
  <!-- emplacement du PLU après traitement -->
  <div id="plu" />
  <script>
    var xslStylesheet;
    var xsltProcessor = new XSLTProcessor();
    var xmlDoc;

    // chargement du fichier xml
    myXMLHTTPRequest = new XMLHttpRequest();
    //ici adresse du XML du PLU sur mon localhost
    myXMLHTTPRequest.open("GET", "http://localhost:8080/jaleyrac/15079_reglement_20190128.xml", false);
    myXMLHTTPRequest.send(null);
    xmlDoc = myXMLHTTPRequest.responseXML;

    //fonction déclanchée par la liste déroulante
    function Init(){
    //changement de la valeur du zonage à partir de la liste déroulante
    var i = document.Choix.Liste.selectedIndex;
    var monZonage = document.Choix.Liste.options[i].value;

    document.getElementById("plu").innerHTML = "";
    //si choix Toutes les zones, alors on ne passe pas par XSLT
    if (monZonage =="all") {
      for(var i = 0; i < xmlDoc.documentElement.childNodes.length; i++) {
       document.getElementById("plu").appendChild(document.importNode(xmlDoc.documentElement.childNodes[i], true));

     };
   } else
   { 
    // chargement du fichier xslt
    var myXMLHTTPRequest = new XMLHttpRequest();
    //ici adresse du XSL sur mon localhost
    myXMLHTTPRequest.open("GET", "http://localhost:8080/jaleyrac/filtre zone.xsl", false);
    myXMLHTTPRequest.send(null);

    xslStylesheet = myXMLHTTPRequest.responseXML;
    xsltProcessor.reset();
    xsltProcessor.importStylesheet(xslStylesheet);
   
   //initialisation du processeur xslt
   xsltProcessor.setParameter(null,"idZone", monZonage);
   var fragment = xsltProcessor.transformToFragment(xmlDoc, document);
   document.getElementById("plu").appendChild(fragment);
 }

}
//lancement de la fonction à l'ouverture de la page
Init();
</script>
</body>
</html> 
